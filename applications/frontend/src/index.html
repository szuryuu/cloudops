<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GOPHER OPS // TASK MANAGER</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@400;500;700&family=Nanum+Pen+Script&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                        hand: ['Nanum Pen Script', 'cursive'],
                    },
                    colors: {
                        background: '#050505',
                        surface: '#0A0A0A',
                        border: '#27272a', // zinc-800
                        accent: '#f97316', // orange-500
                    },
                    backgroundImage: {
                        'grid-pattern': "linear-gradient(to right, #27272a 1px, transparent 1px), linear-gradient(to bottom, #27272a 1px, transparent 1px)",
                    }
                }
            }
        }
    </script>

    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Custom Scrollbar for Raw Feel */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: #3f3f46; }
        ::-webkit-scrollbar-thumb:hover { background: #52525b; }
        
        /* Subtle Grid Background */
        .bg-grid {
            background-size: 40px 40px;
            background-image: radial-gradient(circle, #27272a 1px, transparent 1px);
        }
    </style>
</head>
<body class="bg-background text-zinc-300 min-h-screen font-sans selection:bg-accent selection:text-black">

    <div class="max-w-5xl mx-auto border-x border-border min-h-screen bg-grid flex flex-col relative">

        <header class="border-b border-border bg-background/95 backdrop-blur-sm sticky top-0 z-10">
            <div class="p-6 flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-extrabold tracking-tighter text-white uppercase">
                        Gopher<span class="text-accent">Ops</span>
                    </h1>
                    <div class="flex items-center gap-2 mt-1">
                        <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                        <p class="font-mono text-xs text-zinc-500 uppercase tracking-widest">System Online // v1.0.0</p>
                    </div>
                </div>
                
                <div class="font-mono text-xs text-right hidden sm:block text-zinc-500">
                    <p>MEM: 24MB / 512MB</p>
                    <p>UPTIME: 14h 22m</p>
                </div>
            </div>
            
            <div class="grid grid-cols-4 border-t border-border font-mono text-[10px] text-zinc-500 divide-x divide-border">
                <div class="p-2 text-center bg-surface">REGION: AP-SOUTHEAST</div>
                <div class="p-2 text-center">ENV: PRODUCTION</div>
                <div class="p-2 text-center">USER: ADMIN</div>
                <div class="p-2 text-center text-accent">SECURE_MODE: TRUE</div>
            </div>
        </header>

        <main class="flex-1 grid grid-cols-1 md:grid-cols-12 divide-y md:divide-y-0 md:divide-x divide-border">
            
            <aside class="md:col-span-4 p-6 bg-surface/50 relative">
                <div class="sticky top-40 space-y-6">
                    
                    <div>
                        <label class="font-mono text-xs text-accent mb-2 block uppercase font-bold tracking-wider">
                            > Initialize New Task
                        </label>
                        <div class="relative group">
                            <input type="text" id="taskInput" 
                                class="w-full bg-black border border-zinc-700 p-4 font-mono text-sm text-white focus:outline-none focus:border-accent focus:ring-1 focus:ring-accent transition-all placeholder:text-zinc-700"
                                placeholder="ENTER_TASK_PROTOCOL..."
                            >
                            <div class="absolute right-3 top-4 text-zinc-700 group-focus-within:text-accent">
                                <i data-lucide="terminal-square" class="w-5 h-5"></i>
                            </div>
                        </div>
                    </div>

                    <button onclick="createTask()" 
                        class="w-full bg-zinc-900 border border-zinc-700 hover:border-accent hover:bg-accent hover:text-black text-white p-3 font-mono text-xs font-bold uppercase tracking-widest transition-all active:scale-[0.98] flex items-center justify-center gap-2 group">
                        <i data-lucide="plus" class="w-4 h-4 group-hover:rotate-90 transition-transform"></i>
                        Execute Command
                    </button>

                    <div class="pt-6 border-t border-zinc-800">
                        <p class="font-mono text-[10px] text-zinc-600 mb-2 uppercase">Recent Logs</p>
                        <div id="statusLog" class="font-mono text-xs space-y-1 text-zinc-500 h-32 overflow-y-auto">
                            <p>> System ready...</p>
                            <p>> Waiting for input...</p>
                        </div>
                    </div>
                </div>
            </aside>

            <section class="md:col-span-8 bg-background flex flex-col">
                <div class="p-4 border-b border-border flex justify-between items-center bg-zinc-900/30">
                    <h2 class="font-bold text-sm tracking-wide text-zinc-100 flex items-center gap-2">
                        <i data-lucide="list" class="w-4 h-4 text-accent"></i>
                        ACTIVE PROCESSES
                    </h2>
                    <span class="font-mono text-xs bg-zinc-800 px-2 py-1 rounded-sm text-zinc-400" id="taskCount">0 ITEMS</span>
                </div>

                <ul id="taskList" class="divide-y divide-border">
                    <li class="p-8 text-center animate-pulse">
                        <p class="font-mono text-xs text-accent">> CONNECTING TO DATABASE...</p>
                    </li>
                </ul>
            </section>
        </main>

        <footer class="border-t border-border p-4 bg-surface text-center">
            <p class="font-mono text-[10px] text-zinc-600">
                GOPHER_OPS SYSTEMS INC. // <span class="text-zinc-400">AUTHORIZED ACCESS ONLY</span>
            </p>
        </footer>

    </div>

    <script>
        // Init Icons
        lucide.createIcons();

        // CONFIG
        const API_URL = "http://localhost:8000"; 
        
        // UTILS: Logger
        function log(message, type = 'info') {
            const logBox = document.getElementById('statusLog');
            const time = new Date().toLocaleTimeString('en-US', { hour12: false });
            const color = type === 'error' ? 'text-red-500' : 'text-zinc-400';
            logBox.innerHTML = `<p class="${color}">[${time}] > ${message}</p>` + logBox.innerHTML;
        }

        // 1. READ
        async function loadTasks() {
            try {
                const response = await fetch(`${API_URL}/tasks`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const result = await response.json();
                const tasks = result.data || [];
                
                renderList(tasks);
                document.getElementById('taskCount').innerText = `${tasks.length} ITEMS`;
                log(`Fetched ${tasks.length} records successfully.`);
            } catch (error) {
                console.error(error);
                log(`Connection Failed: ${error.message}`, 'error');
                document.getElementById('taskList').innerHTML = `
                    <li class="p-12 text-center flex flex-col items-center justify-center gap-4">
                        <i data-lucide="wifi-off" class="w-8 h-8 text-red-500"></i>
                        <span class="font-mono text-xs text-red-500">CONNECTION_LOST // CHECK BACKEND</span>
                    </li>
                `;
                lucide.createIcons();
            }
        }

        // 2. CREATE
        async function createTask() {
            const input = document.getElementById('taskInput');
            const content = input.value;
            if (!content) return;

            try {
                log(`Sending payload: ${content}...`);
                const response = await fetch(`${API_URL}/tasks`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ content: content, status: "pending" })
                });

                if (!response.ok) throw new Error("Creation failed");

                input.value = ""; 
                loadTasks(); 
            } catch (error) {
                log(`Error: ${error.message}`, 'error');
            }
        }

        // 3. UPDATE
        async function updateTask(id, currentStatus) {
            try {
                const newStatus = currentStatus === 'done' ? 'pending' : 'done';
                log(`Updating Process #${id} -> ${newStatus.toUpperCase()}`);
                
                const response = await fetch(`${API_URL}/tasks/${id}`, {
                    method: "PUT",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ status: newStatus })
                });

                if (!response.ok) throw new Error("Update failed");
                loadTasks();
            } catch (error) {
                log(`Update Error: ${error.message}`, 'error');
            }
        }

        // 4. DELETE
        async function deleteTask(id) {
            if(!confirm("CONFIRM TERMINATION: Are you sure you want to delete this process?")) return;

            try {
                log(`Terminating Process #${id}...`);
                const response = await fetch(`${API_URL}/tasks/${id}`, {
                    method: "DELETE"
                });

                if (!response.ok) throw new Error("Delete failed");
                loadTasks();
            } catch (error) {
                log(`Termination Error: ${error.message}`, 'error');
            }
        }

        // RENDER UI
        function renderList(tasks) {
            const list = document.getElementById('taskList');
            list.innerHTML = "";
            
            if (tasks.length === 0) {
                list.innerHTML = `
                    <li class="p-12 text-center opacity-50">
                        <p class="font-mono text-xs">NO ACTIVE PROCESSES FOUND</p>
                    </li>`;
                return;
            }

            tasks.forEach(task => {
                const isDone = task.status === 'done';
                
                // Styles berdasarkan status
                const statusColor = isDone ? 'text-green-500 border-green-900/30 bg-green-900/10' : 'text-zinc-500 border-transparent';
                const textStyle = isDone ? 'text-zinc-600 line-through' : 'text-zinc-200';
                const icon = isDone ? 'check-circle-2' : 'circle';

                const html = `
                    <li class="group flex items-center justify-between p-4 hover:bg-zinc-900/50 transition-colors border-l-2 ${isDone ? 'border-green-500' : 'border-transparent hover:border-accent'}">
                        <div class="flex items-center gap-4 flex-1">
                            <span class="font-mono text-[10px] text-zinc-600">ID:${task.id.toString().padStart(3, '0')}</span>
                            <span class="${textStyle} font-medium font-sans text-sm tracking-wide">${task.content}</span>
                            ${isDone ? '<span class="font-mono text-[9px] px-1 border border-green-800 text-green-500 rounded">COMPLETED</span>' : ''}
                        </div>
                        
                        <div class="flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                            <button onclick="updateTask(${task.id}, '${task.status}')" 
                                class="p-2 hover:bg-zinc-800 rounded-sm text-zinc-400 hover:text-white transition-colors" title="Toggle Status">
                                <i data-lucide="${icon}" class="w-4 h-4"></i>
                            </button>
                            <button onclick="deleteTask(${task.id})" 
                                class="p-2 hover:bg-red-900/30 rounded-sm text-zinc-600 hover:text-red-500 transition-colors" title="Terminate">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </li>
                `;
                list.innerHTML += html;
            });
            
            // Re-initialize icons for new elements
            lucide.createIcons();
        }

        // Initialize on Load
        loadTasks();

        // Event Listener for Enter Key
        document.getElementById('taskInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                createTask();
            }
        });
    </script>
</body>
</html>
